<Window x:Class="RentACar.View.MainAgentWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:RentACar.Converters"
        xmlns:view="clr-namespace:RentACar.View"
        Title="Premium Car Rental - Dashboard"
        Height="800"
        Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        ResizeMode="NoResize"
        Background="Transparent"
        Icon="pack://application:,,,/Res/icon.png"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <local:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
        <local:BoolToAngleConverter x:Key="BoolToAngleConverter" />
        <view:UserManagement x:Key="UserManagement" />
    </Window.Resources>

    <Border CornerRadius="30"
            Background="{DynamicResource BackgroundBrush}">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20"
                              Direction="-90"
                              RenderingBias="Quality"
                              ShadowDepth="3"
                              Opacity="0.2" />
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Border Grid.Row="0"
                    Height="100"
                    CornerRadius="30,30,0,0"
                    Background="{DynamicResource BackgroundBrush}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <StackPanel Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="30,0,0,0">
                        <TextBlock Text="PREMIUM CAR RENTAL"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                    </StackPanel>
                    <Grid Grid.Column="1"
                          Margin="0,0,20,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0"
                                    Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center">
                            <!-- Minimize Button -->
                            <Button Width="40"
                                    Height="40"
                                    Margin="0,10,10,0"
                                    Command="{Binding MinimizeCommand}"
                                    ToolTip="Minimize"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Cursor="Hand">
                                <TextBlock Text="—"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           FontSize="14"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Button>
                            <!-- Close Button -->
                            <Button Width="40"
                                    Height="40"
                                    Command="{Binding CloseCommand}"
                                    ToolTip="Close"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Cursor="Hand">
                                <TextBlock Text="✕"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           FontSize="14"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Button>
                        </StackPanel>

                        <StackPanel Grid.Row="1"
                                    Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Margin="0,5,50,0">
                            <!-- Language Selector -->
                            <Grid Margin="0,0,10,0">
                                <Button x:Name="btnLanguage"
                                        Width="70"
                                        Height="30"
                                        Click="OnLanguageClick"
                                        ToolTip="Change Language"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Cursor="Hand">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="🌐"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   FontSize="16"
                                                   VerticalAlignment="Center" />
                                        <TextBlock x:Name="txtLanguageCode"
                                                   Text="EN"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   FontSize="12"
                                                   FontWeight="SemiBold"
                                                   Margin="5,0,0,0"
                                                   VerticalAlignment="Center" />
                                    </StackPanel>
                                </Button>

                                <!-- Language Popup Menu -->
                                <Popup x:Name="languagePopup"
                                       PlacementTarget="{Binding ElementName=btnLanguage}"
                                       Placement="Bottom"
                                       StaysOpen="False"
                                       PopupAnimation="Fade"
                                       AllowsTransparency="True"
                                       HorizontalOffset="-60">
                                    <Border Background="{DynamicResource BackgroundBrush}"
                                            CornerRadius="5"
                                            BorderBrush="{DynamicResource BorderBrush}"
                                            BorderThickness="2"
                                            Padding="5">
                                        <StackPanel>
                                            <Button Content="English"
                                                    Tag="0"
                                                    Click="OnLanguageItemClick"
                                                    Width="120"
                                                    Height="30"
                                                    Margin="0,2"
                                                    HorizontalContentAlignment="Left"
                                                    Padding="10,0,0,0">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Background"
                                                                Value="Transparent" />
                                                        <Setter Property="BorderThickness"
                                                                Value="0" />
                                                        <Setter Property="Cursor"
                                                                Value="Hand" />
                                                        <Setter Property="Foreground"
                                                                Value="{DynamicResource TextPrimaryBrush}" />
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter Property="Background"
                                                                        Value="{DynamicResource InputBackgroundBrush}" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                            <Button Content="Serbian"
                                                    Tag="1"
                                                    Click="OnLanguageItemClick"
                                                    Width="120"
                                                    Height="30"
                                                    Margin="0,2"
                                                    HorizontalContentAlignment="Left"
                                                    Padding="10,0,0,0">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Background"
                                                                Value="Transparent" />
                                                        <Setter Property="BorderThickness"
                                                                Value="0" />
                                                        <Setter Property="Cursor"
                                                                Value="Hand" />
                                                        <Setter Property="Foreground"
                                                                Value="{DynamicResource TextPrimaryBrush}" />
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter Property="Background"
                                                                        Value="{DynamicResource InputBackgroundBrush}" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                            <Button Content="German"
                                                    Tag="2"
                                                    Click="OnLanguageItemClick"
                                                    Width="120"
                                                    Height="30"
                                                    Margin="0,2"
                                                    HorizontalContentAlignment="Left"
                                                    Padding="10,0,0,0">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Background"
                                                                Value="Transparent" />
                                                        <Setter Property="BorderThickness"
                                                                Value="0" />
                                                        <Setter Property="Cursor"
                                                                Value="Hand" />
                                                        <Setter Property="Foreground"
                                                                Value="{DynamicResource TextPrimaryBrush}" />
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter Property="Background"
                                                                        Value="{DynamicResource InputBackgroundBrush}" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </StackPanel>
                                    </Border>
                                </Popup>
                            </Grid>

                            <!-- Theme Selector -->
                            <Grid Margin="0,0,10,0">
                                <Button x:Name="btnTheme"
                                        Width="70"
                                        Height="30"
                                        Click="OnThemeClick"
                                        ToolTip="Change Theme"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Cursor="Hand">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="🎨"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   FontSize="16"
                                                   VerticalAlignment="Center" />
                                        <TextBlock x:Name="txtThemeName"
                                                   Text="light"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   FontSize="12"
                                                   FontWeight="SemiBold"
                                                   Margin="5,0,0,0"
                                                   VerticalAlignment="Bottom" />
                                    </StackPanel>
                                </Button>

                                <!-- Theme Popup Menu -->
                                <Popup x:Name="themePopup"
                                       PlacementTarget="{Binding ElementName=btnTheme}"
                                       Placement="Bottom"
                                       StaysOpen="False"
                                       PopupAnimation="Fade"
                                       AllowsTransparency="True"
                                       HorizontalOffset="-60">
                                    <Border Background="{DynamicResource BackgroundBrush}"
                                            CornerRadius="5"
                                            BorderBrush="{DynamicResource BorderBrush}"
                                            BorderThickness="2"
                                            Padding="5">
                                        <StackPanel>
                                            <Button Content="Light"
                                                    Tag="0"
                                                    Click="OnThemeItemClick"
                                                    Width="120"
                                                    Height="30"
                                                    Margin="0,2"
                                                    HorizontalContentAlignment="Left"
                                                    Padding="10,0,0,0">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Background"
                                                                Value="Transparent" />
                                                        <Setter Property="BorderThickness"
                                                                Value="0" />
                                                        <Setter Property="Cursor"
                                                                Value="Hand" />
                                                        <Setter Property="Foreground"
                                                                Value="{DynamicResource TextPrimaryBrush}" />
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter Property="Background"
                                                                        Value="{DynamicResource InputBackgroundBrush}" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                            <Button Content="Dark"
                                                    Tag="1"
                                                    Click="OnThemeItemClick"
                                                    Width="120"
                                                    Height="30"
                                                    Margin="0,2"
                                                    HorizontalContentAlignment="Left"
                                                    Padding="10,0,0,0">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Background"
                                                                Value="Transparent" />
                                                        <Setter Property="BorderThickness"
                                                                Value="0" />
                                                        <Setter Property="Cursor"
                                                                Value="Hand" />
                                                        <Setter Property="Foreground"
                                                                Value="{DynamicResource TextPrimaryBrush}" />
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter Property="Background"
                                                                        Value="{DynamicResource InputBackgroundBrush}" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                            <Button Content="Sea"
                                                    Tag="2"
                                                    Click="OnThemeItemClick"
                                                    Width="120"
                                                    Height="30"
                                                    Margin="0,2"
                                                    HorizontalContentAlignment="Left"
                                                    Padding="10,0,0,0">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Background"
                                                                Value="Transparent" />
                                                        <Setter Property="BorderThickness"
                                                                Value="0" />
                                                        <Setter Property="Cursor"
                                                                Value="Hand" />
                                                        <Setter Property="Foreground"
                                                                Value="{DynamicResource TextPrimaryBrush}" />
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter Property="Background"
                                                                        Value="{DynamicResource InputBackgroundBrush}" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </StackPanel>
                                    </Border>
                                </Popup>
                            </Grid>

                            <!-- Logout Button -->
                            <Button Width="40"
                                    Height="30"
                                    Click="LogoutUser"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Cursor="Hand">
                                <materialDesign:PackIcon Kind="Logout"
                                                         Foreground="{DynamicResource TextSecondaryBrush}"
                                                         Width="16"
                                                         Height="16"
                                                         HorizontalAlignment="Center"
                                                         VerticalAlignment="Center" />
                            </Button>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition x:Name="SidebarColumn"
                                      Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TabControl x:Name="VerticalTabControl"
                            Grid.Column="0"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="0"
                            TabStripPlacement="Left">
                    <TabControl.Resources>
                        <Style TargetType="TabControl">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TabControl">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0"
                                                    CornerRadius="30"
                                                    Margin="5"
                                                    Width="{Binding ElementName=SidebarColumn, Path=Width}">
                                                <Border.Background>
                                                    <LinearGradientBrush StartPoint="0,0"
                                                                         EndPoint="1,1">
                                                        <!--<GradientStop Color="{DynamicResource SecondaryColor}" Offset="0.0"/>-->
                                                        <GradientStop Color="{DynamicResource TextSecondaryColor}"
                                                                      Offset="1.0" />
                                                    </LinearGradientBrush>
                                                </Border.Background>

                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="*" />
                                                        <RowDefinition Height="Auto" />
                                                    </Grid.RowDefinitions>

                                                    <StackPanel Grid.Row="0"
                                                                Orientation="Vertical"
                                                                Margin="10,30,10,20">
                                                        <TextBlock Text="{DynamicResource MenuText}"
                                                                   Foreground="White"
                                                                   FontSize="22"
                                                                   HorizontalAlignment="Center"
                                                                   FontWeight="Bold"
                                                                   Visibility="{Binding IsMenuExpanded, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                                        <TextBlock Text=""
                                                                   Foreground="White"
                                                                   FontSize="22"
                                                                   HorizontalAlignment="Center"
                                                                   FontWeight="Bold"
                                                                   Visibility="{Binding IsMenuExpanded, Converter={StaticResource InverseBooleanToVisibilityConverter}}" />
                                                    </StackPanel>

                                                    <ScrollViewer Grid.Row="1"
                                                                  VerticalScrollBarVisibility="Auto"
                                                                  HorizontalScrollBarVisibility="Disabled">
                                                        <ItemsPresenter />
                                                    </ScrollViewer>

                                                    <Button x:Name="ToggleMenuButton"
                                                            Grid.Row="2"
                                                            Click="ToggleMenuButton_Click"
                                                            ToolTip="Toggle Menu"
                                                            Height="40"
                                                            HorizontalAlignment="Right"
                                                            Margin="0,10,10,10"
                                                            Background="Transparent"
                                                            BorderBrush="Transparent">
                                                        <StackPanel Orientation="Horizontal"
                                                                    VerticalAlignment="Center">
                                                            <Path x:Name="ChevronIcon"
                                                                  Data="M10,6 L8.59,7.41 13.17,12 l-4.58,4.59 L10,18 l6,-6 z"
                                                                  Width="20"
                                                                  Height="20"
                                                                  Fill="White"
                                                                  RenderTransformOrigin="0.5,0.5">
                                                                <Path.RenderTransform>
                                                                    <RotateTransform Angle="{Binding IsMenuExpanded, Converter={StaticResource BoolToAngleConverter}}" />
                                                                    <!--<RotateTransform Angle="180"/>-->
                                                                </Path.RenderTransform>
                                                            </Path>
                                                        </StackPanel>
                                                    </Button>
                                                </Grid>
                                            </Border>

                                            <!-- Glavni sadržaj -->
                                            <Border Grid.Column="1"
                                                    Margin="20"
                                                    Background="{DynamicResource BackgroundBrush}"
                                                    CornerRadius="15">
                                                <ContentPresenter Content="{TemplateBinding SelectedContent}" />
                                            </Border>
                                        </Grid>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>

                        <Style TargetType="TabItem">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TabItem">
                                        <Grid x:Name="Root"
                                              Margin="10,5"
                                              Height="70">
                                            <Border x:Name="Border"
                                                    CornerRadius="15"
                                                    Background="Transparent">
                                                <!--<Border.Effect>
                                                    <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="5" Opacity="0.3"/>
                                                </Border.Effect>-->
                                                <Grid>
                                                    <StackPanel Orientation="Horizontal"
                                                                Margin="10,0">
                                                        <ContentPresenter x:Name="ContentSite"
                                                                          ContentSource="Header"
                                                                          VerticalAlignment="Center" />
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </Grid>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected"
                                                     Value="True">
                                                <Setter TargetName="Border"
                                                        Property="Background"
                                                        Value="LightGray" />
                                            </Trigger>
                                            <Trigger Property="IsMouseOver"
                                                     Value="True">
                                                <Setter TargetName="Border"
                                                        Property="Background"
                                                        Value="LightGray" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Setter Property="Foreground"
                                    Value="White" />
                            <Setter Property="FontSize"
                                    Value="14" />
                            <Setter Property="FontWeight"
                                    Value="SemiBold" />
                            <Setter Property="Cursor"
                                    Value="Hand" />
                        </Style>
                    </TabControl.Resources>

                    <!-- Tab 0: Users -->
                    <TabItem>
                        <TabItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <Image Source="pack://application:,,,/Res/users.png"
                                       Width="50"
                                       Height="50" />
                                <TextBlock Text="{DynamicResource ClientsTab}"
                                           Margin="10,0,0,0"
                                           Foreground="White"
                                           VerticalAlignment="Center"
                                           Visibility="{Binding IsMenuExpanded, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </StackPanel>
                        </TabItem.Header>
                        <view:ClientManagement>
                            
                        </view:ClientManagement>
                    </TabItem>

                    <!-- Tab 1: Rentals -->
                    <TabItem>
                        <TabItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <Image Source="pack://application:,,,/Res/rentals.png"
                                       Width="50"
                                       Height="50" />
                                <TextBlock Text="{DynamicResource RentalsTab}"
                                           Margin="10,0,0,0"
                                           Foreground="White"
                                           VerticalAlignment="Center"
                                           Visibility="{Binding IsMenuExpanded, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </StackPanel>
                        </TabItem.Header>
                        <view:AgentRentalsManagement DataContext="{Binding CurrentUser}">
                            
                        </view:AgentRentalsManagement>
                    </TabItem>
                    <!-- Tab 2: Vehicles -->
                    <TabItem>
                        <TabItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <Image Source="pack://application:,,,/Res/vehicles.png"
                                       Width="50"
                                       Height="50" />
                                <TextBlock Text="{DynamicResource VehiclesTab}"
                                           Margin="10,0,0,0"
                                           Foreground="White"
                                           VerticalAlignment="Center"
                                           Visibility="{Binding IsMenuExpanded, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </StackPanel>
                        </TabItem.Header>
                        <view:AgentVehicleManagement DataContext="{Binding CurrentUser}">
                            
                        </view:AgentVehicleManagement>
                    </TabItem>

                    <!-- Tab 3: Problems -->
                    <TabItem>
                        <TabItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <Image Source="pack://application:,,,/Res/problems.png"
                                       Width="50"
                                       Height="50" />
                                <TextBlock Text="{DynamicResource ProblemsTab}"
                                           Margin="10,0,0,0"
                                           Foreground="White"
                                           VerticalAlignment="Center"
                                           Visibility="{Binding IsMenuExpanded, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </StackPanel>
                        </TabItem.Header>
                        <view:AgentProblemsManagement DataContext="{Binding CurrentUser}">

                        </view:AgentProblemsManagement>
                    </TabItem>

                    <!-- Tab 4: Settings -->
                    <TabItem>
                        <TabItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <Image Source="pack://application:,,,/Res/settings.png"
                                       Width="50"
                                       Height="50" />
                                <TextBlock Text="{DynamicResource SettingsTab}"
                                           Margin="10,0,0,0"
                                           Foreground="White"
                                           VerticalAlignment="Center"
                                           Visibility="{Binding IsMenuExpanded, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </StackPanel>
                        </TabItem.Header>
                        <view:UserSettings DataContext="{Binding CurrentUser}">

                        </view:UserSettings>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>
    </Border>

</Window>